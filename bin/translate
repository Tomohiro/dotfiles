#!/usr/bin/env ruby

require 'rubygems'
require 'json'
require 'open-uri'

module Translate
  def self.google(src, to = 'ja')
    base_uri = 'http://ajax.googleapis.com/ajax/services/language'
    begin
      detect = JSON.parse(open("#{base_uri}/detect?v=1.0&q=#{URI.encode(src)}").read)
      from = detect['responseData']['language'] == 'en' ? 'en' : 'ja'
      to = 'en' if to == from

      langpair = "langpair=#{from}%7C#{to}"
      result = JSON.parse(open("#{base_uri}/translate?v=1.0&q=#{URI.encode(src)}&#{langpair}").read)

      result['responseData']['translatedText']
    rescue Exception => e
      "Google: Translation Faild. \n #{e.inspect}"
    end
  end
end

if __FILE__ == $0 
  puts Translate.google(ARGV.join(' '))
end
