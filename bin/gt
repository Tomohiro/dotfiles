#!/usr/bin/env ruby

require 'json'
require 'open-uri'

module Google

  API_URI = 'http://ajax.googleapis.com/ajax/services/language'

  def self.translate(text)
    begin
      encoded = URI.encode text

      detect = JSON.parse(open("#{API_URI}/detect?v=1.0&q=#{encoded}").read)
      from, to = detect['responseData']['language'] == 'en' ? %w[en ja] : %w[ja en]

      result = JSON.parse(open("#{API_URI}/translate?v=1.0&q=#{encoded}&langpair=#{from}%7C#{to}").read)

      result['responseData']['translatedText']
    rescue Exception => e
      "Google: Translation Faild. #{e.to_s}."
    end
  end
end

if __FILE__ == $0
  text = STDIN.isatty ? ARGV : STDIN.readlines
  abort 'Please enter the text.' if text.count == 0

  puts Google.translate text.join ' '
end
